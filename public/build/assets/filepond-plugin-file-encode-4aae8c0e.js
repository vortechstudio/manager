/*!
 * FilePondPluginFileEncode 2.1.14
 * Licensed under MIT, https://opensource.org/licenses/MIT/
 * Please visit https://pqina.nl/filepond/ for details.
 */const D=function(){self.onmessage=r=>{o(r.data.message,E=>{self.postMessage({id:r.data.id,message:E})})};const o=(r,E)=>{const{file:l}=r,c=new FileReader;c.onloadend=()=>{E(c.result.replace("data:","").replace(/^.+,/,""))},c.readAsDataURL(l)}},P=({addFilter:o,utils:r})=>{const{Type:E,createWorker:l,createRoute:c,isFile:T}=r,f=({name:e,file:a})=>new Promise(s=>{const t=l(D);t.post({file:a},n=>{s({name:e,data:n}),t.terminate()})}),d=[];return o("DID_CREATE_ITEM",(e,{query:a})=>{a("GET_ALLOW_FILE_ENCODE")&&(e.extend("getFileEncodeBase64String",()=>d[e.id]&&d[e.id].data),e.extend("getFileEncodeDataURL",()=>d[e.id]&&`data:${e.fileType};base64,${d[e.id].data}`))}),o("SHOULD_PREPARE_OUTPUT",(e,{query:a})=>new Promise(s=>{s(a("GET_ALLOW_FILE_ENCODE"))})),o("COMPLETE_PREPARE_OUTPUT",(e,{item:a,query:s})=>new Promise(t=>{if(!s("GET_ALLOW_FILE_ENCODE")||!T(e)&&!Array.isArray(e))return t(e);d[a.id]={metadata:a.getMetadata(),data:null},Promise.all((e instanceof Blob?[{name:null,file:e}]:e).map(f)).then(n=>{d[a.id].data=e instanceof Blob?n[0].data:n,t(e)})})),o("CREATE_VIEW",e=>{const{is:a,view:s,query:t}=e;!a("file-wrapper")||!t("GET_ALLOW_FILE_ENCODE")||s.registerWriter(c({DID_PREPARE_OUTPUT:({root:n,action:_})=>{if(t("IS_ASYNC"))return;const i=t("GET_ITEM",_.id);if(!i)return;const u=d[i.id],L=u.metadata,O=u.data,p=JSON.stringify({id:i.id,name:i.file.name,type:i.file.type,size:i.file.size,metadata:L,data:O});n.ref.data?n.ref.data.value=p:n.dispatch("DID_DEFINE_VALUE",{id:i.id,value:p})},DID_REMOVE_ITEM:({action:n})=>{const _=t("GET_ITEM",n.id);_&&delete d[_.id]}}))}),{options:{allowFileEncode:[!0,E.BOOLEAN]}}},A=typeof window<"u"&&typeof window.document<"u";A&&document.dispatchEvent(new CustomEvent("FilePond:pluginloaded",{detail:P}));export{P as p};
