/*!
 * FilePondPluginImageEdit 1.6.3
 * Licensed under MIT, https://opensource.org/licenses/MIT/
 * Please visit https://pqina.nl/filepond/ for details.
 */const L=G=>/^image/.test(G.type),K=G=>{const{addFilter:m,utils:N,views:P}=G,{Type:f,createRoute:b,createItemAPI:R=n=>n}=N,{fileActionButton:y}=P;m("SHOULD_REMOVE_ON_REVERT",(n,{item:a,query:l})=>new Promise(o=>{const{file:r}=a,g=l("GET_ALLOW_IMAGE_EDIT")&&l("GET_IMAGE_EDIT_ALLOW_EDIT")&&L(r);o(!g)})),m("DID_LOAD_ITEM",(n,{query:a,dispatch:l})=>new Promise((o,r)=>{if(n.origin>1){o(n);return}const{file:g}=n;if(!a("GET_ALLOW_IMAGE_EDIT")||!a("GET_IMAGE_EDIT_INSTANT_EDIT")){o(n);return}if(!L(g)){o(n);return}const t=(d,I,e)=>s=>{T.shift(),s?I(d):e(d),l("KICK"),A()},A=()=>{if(!T.length)return;const{item:d,resolve:I,reject:e}=T[0];l("EDIT_ITEM",{id:d.id,handleEditorResponse:t(d,I,e)})};k({item:n,resolve:o,reject:r}),T.length===1&&A()})),m("DID_CREATE_ITEM",(n,{query:a,dispatch:l})=>{n.extend("edit",()=>{l("EDIT_ITEM",{id:n.id})})});const T=[],k=n=>(T.push(n),n);return m("CREATE_VIEW",n=>{const{is:a,view:l,query:o}=n;if(!o("GET_ALLOW_IMAGE_EDIT"))return;const r=o("GET_ALLOW_IMAGE_PREVIEW");if(!(a("file-info")&&!r||a("file")&&r))return;const t=o("GET_IMAGE_EDIT_EDITOR");if(!t)return;t.filepondCallbackBridge||(t.outputData=!0,t.outputFile=!1,t.filepondCallbackBridge={onconfirm:t.onconfirm||(()=>{}),oncancel:t.oncancel||(()=>{})});const A=({root:e,props:s,action:M})=>{const{id:D}=s,{handleEditorResponse:_}=M;t.cropAspectRatio=e.query("GET_IMAGE_CROP_ASPECT_RATIO")||t.cropAspectRatio,t.outputCanvasBackgroundColor=e.query("GET_IMAGE_TRANSFORM_CANVAS_BACKGROUND_COLOR")||t.outputCanvasBackgroundColor;const i=e.query("GET_ITEM",D);if(!i)return;const c=i.file,S=i.getMetadata("crop"),V={center:{x:.5,y:.5},flip:{horizontal:!1,vertical:!1},zoom:1,rotation:0,aspectRatio:null},p=i.getMetadata("resize"),W=i.getMetadata("filter")||null,w=i.getMetadata("filters")||null,C=i.getMetadata("colors")||null,q=i.getMetadata("markup")||null,x={crop:S||V,size:p?{upscale:p.upscale,mode:p.mode,width:p.size.width,height:p.size.height}:null,filter:w?w.id||w.matrix:e.query("GET_ALLOW_IMAGE_FILTER")&&e.query("GET_IMAGE_FILTER_COLOR_MATRIX")&&!C?W:null,color:C,markup:q};t.onconfirm=({data:B})=>{const{crop:v,size:h,filter:F,color:H,colorMatrix:U,markup:z}=B,E={};if(v&&(E.crop=v),h){const O=(i.getMetadata("resize")||{}).size,u={width:h.width,height:h.height};!(u.width&&u.height)&&O&&(u.width=O.width,u.height=O.height),(u.width||u.height)&&(E.resize={upscale:h.upscale,mode:h.mode,size:u})}z&&(E.markup=z),E.colors=H,E.filters=F,E.filter=U,i.setMetadata(E),t.filepondCallbackBridge.onconfirm(B,R(i)),_&&(t.onclose=()=>{_(!0),t.onclose=null})},t.oncancel=()=>{t.filepondCallbackBridge.oncancel(R(i)),_&&(t.onclose=()=>{_(!1),t.onclose=null})},t.open(c,x)},d=({root:e,props:s})=>{if(!o("GET_IMAGE_EDIT_ALLOW_EDIT"))return;const{id:M}=s,D=o("GET_ITEM",M);if(!D)return;const _=D.file;if(L(_))if(e.ref.handleEdit=i=>{i.stopPropagation(),e.dispatch("EDIT_ITEM",{id:M})},r){const i=l.createChildView(y,{label:"edit",icon:o("GET_IMAGE_EDIT_ICON_EDIT"),opacity:0});i.element.classList.add("filepond--action-edit-item"),i.element.dataset.align=o("GET_STYLE_IMAGE_EDIT_BUTTON_EDIT_ITEM_POSITION"),i.on("click",e.ref.handleEdit),e.ref.buttonEditItem=l.appendChildView(i)}else{const i=l.element.querySelector(".filepond--file-info-main"),c=document.createElement("button");c.className="filepond--action-edit-item-alt",c.innerHTML=o("GET_IMAGE_EDIT_ICON_EDIT")+"<span>edit</span>",c.addEventListener("click",e.ref.handleEdit),i.appendChild(c),e.ref.editButton=c}};l.registerDestroyer(({root:e})=>{e.ref.buttonEditItem&&e.ref.buttonEditItem.off("click",e.ref.handleEdit),e.ref.editButton&&e.ref.editButton.removeEventListener("click",e.ref.handleEdit)});const I={EDIT_ITEM:A,DID_LOAD_ITEM:d};if(r){const e=({root:s})=>{s.ref.buttonEditItem&&(s.ref.buttonEditItem.opacity=1)};I.DID_IMAGE_PREVIEW_SHOW=e}l.registerWriter(b(I))}),{options:{allowImageEdit:[!0,f.BOOLEAN],styleImageEditButtonEditItemPosition:["bottom center",f.STRING],imageEditInstantEdit:[!1,f.BOOLEAN],imageEditAllowEdit:[!0,f.BOOLEAN],imageEditIconEdit:['<svg width="26" height="26" viewBox="0 0 26 26" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false"><path d="M8.5 17h1.586l7-7L15.5 8.414l-7 7V17zm-1.707-2.707l8-8a1 1 0 0 1 1.414 0l3 3a1 1 0 0 1 0 1.414l-8 8A1 1 0 0 1 10.5 19h-3a1 1 0 0 1-1-1v-3a1 1 0 0 1 .293-.707z" fill="currentColor" fill-rule="nonzero"/></svg>',f.STRING],imageEditEditor:[null,f.OBJECT]}}},j=typeof window<"u"&&typeof window.document<"u";j&&document.dispatchEvent(new CustomEvent("FilePond:pluginloaded",{detail:K}));export{K as p};
